"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª.
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –Ω–∞ Railway.
"""

import asyncio
from bot import AutoPosterBot
from config import CHANNEL_IDS, BOT_TOKEN, logger


async def send_test():
    """–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ."""
    print("=" * 70)
    print("üß™ –û–¢–ü–†–ê–í–ö–ê –¢–ï–°–¢–û–í–û–ì–û –°–û–û–ë–©–ï–ù–ò–Ø")
    print("=" * 70)
    print(f"\nü§ñ –¢–æ–∫–µ–Ω –±–æ—Ç–∞: {BOT_TOKEN[:15]}...{BOT_TOKEN[-5:]}")
    print(f"üì∫ –ö–∞–Ω–∞–ª—ã: {CHANNEL_IDS}")
    print(f"üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–∞–ª–æ–≤: {len(CHANNEL_IDS)}\n")
    
    # –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞
    bot = AutoPosterBot()
    
    # –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    test_message = {
        'id': 999,
        'title': '–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',
        'text': 'üß™ <b>–¢–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω!</b>\n\n'
                '‚úÖ –ë–æ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.\n'
                '‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞.\n'
                '‚úÖ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è.\n\n'
                'ü§ñ –ê–≤—Ç–æ–ø–æ—Å—Ç–∏–Ω–≥ –±–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!\n\n'
                '<i>–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å.</i>',
        'photos': ['photos/energy.jpg']  # –û—Ç–ø—Ä–∞–≤–∏–º –æ–¥–Ω–æ —Ñ–æ—Ç–æ –¥–ª—è —Ç–µ—Å—Ç–∞
    }
    
    print("‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è...\n")
    
    success_count = 0
    error_count = 0
    
    for channel_id in CHANNEL_IDS:
        print(f"üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –∫–∞–Ω–∞–ª {channel_id}...")
        
        try:
            success = await bot.send_message_to_channel(channel_id, test_message)
            
            if success:
                print(f"   ‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!\n")
                success_count += 1
            else:
                print(f"   ‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏\n")
                error_count += 1
                
        except Exception as e:
            print(f"   ‚ùå –û—à–∏–±–∫–∞: {e}\n")
            error_count += 1
        
        # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∫–∞–Ω–∞–ª–∞–º–∏
        if len(CHANNEL_IDS) > 1:
            await asyncio.sleep(1)
    
    print("=" * 70)
    print("üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ê")
    print("=" * 70)
    print(f"‚úÖ –£—Å–ø–µ—à–Ω–æ: {success_count}")
    print(f"‚ùå –û—à–∏–±–æ–∫: {error_count}")
    print(f"üìä –í—Å–µ–≥–æ –∫–∞–Ω–∞–ª–æ–≤: {len(CHANNEL_IDS)}")
    
    if success_count > 0:
        print("\nüéâ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à –∫–∞–Ω–∞–ª - –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ñ–æ—Ç–æ.")
        print("\n‚úÖ –ú–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –±–æ—Ç–∞ –Ω–∞ Railway!")
    else:
        print("\n‚ö†Ô∏è  –¢–µ—Å—Ç –Ω–µ –ø—Ä–æ—à—ë–ª. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:")
        print("   1. –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π")
        print("   2. ID –∫–∞–Ω–∞–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å -100)")
        print("   3. –ë–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–∞–Ω–∞–ª –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä")
        print("   4. –£ –±–æ—Ç–∞ –µ—Å—Ç—å –ø—Ä–∞–≤–æ '–ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π'")
    
    print("=" * 70)


if __name__ == '__main__':
    try:
        asyncio.run(send_test())
    except KeyboardInterrupt:
        print("\n\n‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
    except Exception as e:
        logger.error(f"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}", exc_info=True)
        print(f"\n‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
